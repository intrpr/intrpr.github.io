if(typeof(NA)=="undefined"||NA==null){var NA={_tiplist:[],_baseurl:null,_basever:null,_appid:null,_appsecret:null,_requesttoken:null,_usertoken:null,_recognkey:null,_logininfo:null,_defaulttimeout:null,_isatlogin:false,_logincbary:new Array(),storage:function(key,value,time){key=(typeof(key)=="undefined")?null:key;value=(typeof(value)=="undefined")?null:value;time=(typeof(time)=="undefined")?null:time;if(key!=null&&value==null){var cookieValue=null;var search=key+"=";if(document.cookie.length>0){offset=document.cookie.indexOf(search);if(offset!=-1){offset+=search.length;end=document.cookie.indexOf(";",offset);if(end==-1)end=document.cookie.length;cookieValue=unescape(document.cookie.substring(offset,end))}}return cookieValue;}else if(key!=null&&value!=null){var expire="";if(time!=null){expire=new Date((new Date()).getTime()+time*1000);expire="; expires="+expire.toGMTString();}else{expire=new Date((new Date()).getTime()+365*24*3600*1000);expire="; expires="+expire.toGMTString();}document.cookie=key+"="+escape(value)+expire;}},clearStorage:function(){var temp=document.cookie.split(";");var loop3;var ts;for(loop3=0;loop3<temp.length;loop3++){ts=temp[loop3].split("=")[0];var exp=new Date();exp.setTime(exp.getTime()-1);document.cookie=ts+"=; expires="+exp.toGMTString();}},init:function(appid,appsecret,defaulttimeout,basever,baseurl){this._defaulttimeout=(typeof(defaulttimeout)=="undefined")?15:defaulttimeout;this._basever=(typeof(basever)=="undefined")?"v2":basever;this._baseurl=(typeof(baseurl)=="undefined")?"https://api.naturalreaders.com":baseurl;this._appid=appid;this._appsecret=appsecret;if(this.storage("requesttoken")!=null){this._requesttoken=this.storage("NASDK_JS_requesttoken");}if(this.storage("usertoken")!=null){this._usertoken=this.storage("NASDK_JS_usertoken");}if(this.storage("recognkey")!=null){this._recognkey=this.storage("NASDK_JS_recognkey");}},api:function(path,params,cb,tipname){tipname=(typeof(tipname)=="undefined")?"NASDK_Default":tipname;params=(typeof(params)=="undefined")?{}:params;if(tipname!=null){this.beginTip(tipname,null);}var tmpapiobj={};if(params==null){params={};}var baseobj=this;tmpapiobj.isFristRequestError=true;tmpapiobj.isFristUserError=true;tmpapiobj.isFrist=true;tmpapiobj.isCbEnd=false;tmpapiobj.getrequesttoken=function(tmpcb){$.getJSON("https://api.naturalreaders.com/v2/auth/requesttoken?callback=?",{appid:baseobj._appid,appsecret:baseobj._appsecret},null).always(function(rst,status,xhr){if(status!="success"){tmpcb({rst:"ERROR_SERVERERROR"});return;}if(rst.rst!="true"){tmpcb({rst:"ERROR_SERVERERROR"});}else{baseobj._requesttoken=rst.requesttoken;baseobj.storage("NASDK_JS_requesttoken",baseobj._requesttoken);params.requesttoken=baseobj._requesttoken;tmpcb(null);}});}
tmpapiobj.getusertoken=function(tmpcb){baseobj.login(tmpcb,true);}
tmpapiobj.getit=function(err_rst){if(err_rst!=null){if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});return;}if(baseobj._requesttoken==null){}else{params.requesttoken=baseobj._requesttoken;}if(baseobj._usertoken==null){baseobj._usertoken=baseobj.storage("NASDK_JS_usertoken");}if(baseobj._usertoken!=null){params.usertoken=baseobj._usertoken;}else if(baseobj._recognkey!=null){params.recognkey=baseobj._recognkey;}if(tmpapiobj.isFrist==true){tmpapiobj.isFrist=false;}var tmpurl=baseobj._baseurl+"/"+baseobj._basever+"/"+path+"?callback=?";$.getJSON(tmpurl,params,null).always(function(rst,status,xhr){if(status!="success"){if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});return;}if(rst.rst=="ERROR_INVALIDREQUESTTOKEN"){if(tmpapiobj.isFristRequestError==true){tmpapiobj.isFristRequestError=false;tmpapiobj.getrequesttoken(tmpapiobj.getit);}else{if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});}}else if(rst.rst=="ERROR_INVALIDUSERTOKEN"){if(tmpapiobj.isFristUserError==true){tmpapiobj.isFristUserError=false;tmpapiobj.getusertoken(tmpapiobj.getit);}else{if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});}}else{if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb(rst);}});}
if(tmpapiobj.isFrist==true){setTimeout(function(){if(tmpapiobj.isCbEnd==true){return;}else{if(baseobj._isatlogin==true){return;}else{if(tipname!=null){baseobj.endTip(tipname);}cb({rst:"ERROR_SERVERERROR"});}}},baseobj._defaulttimeout*1000);tmpapiobj.getit(null);}},postInput:function(artname,text,cb,tipname){tipname=(typeof(tipname)=="undefined")?"NASDK_Default":tipname;var params={};params.artname=artname;params.text=text;if(tipname!=null){this.beginTip(tipname,null);}var tmpapiobj={};var baseobj=this;tmpapiobj.isFristRequestError=true;tmpapiobj.isFristUserError=true;tmpapiobj.isFrist=true;tmpapiobj.isCbEnd=false;tmpapiobj.getrequesttoken=function(tmpcb){$.getJSON("https://api.naturalreaders.com/v2/auth/requesttoken?callback=?",{appid:baseobj._appid,appsecret:baseobj._appsecret},null).always(function(rst,status,xhr){if(status!="success"){tmpcb({rst:"ERROR_SERVERERROR"});return;}if(rst.rst!="true"){tmpcb({rst:"ERROR_SERVERERROR"});}else{baseobj._requesttoken=rst.requesttoken;baseobj.storage("NASDK_JS_requesttoken",baseobj._requesttoken);params.requesttoken=baseobj._requesttoken;tmpcb(null);}});}
tmpapiobj.getusertoken=function(tmpcb){baseobj.login(tmpcb);}
tmpapiobj.getit=function(err_rst){if(err_rst!=null){if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});return;}if(baseobj._requesttoken==null){}else{params.requesttoken=baseobj._requesttoken;}if(baseobj._usertoken!=null){params.usertoken=baseobj._usertoken;}else if(baseobj._recognkey!=null){params.recognkey=baseobj._recognkey;}if(tmpapiobj.isFrist==true){tmpapiobj.isFrist=false;}var tmpurl="https://www.naturalreaders.com/postinput";$.post(tmpurl,params,null).always(function(rst,status,xhr){if(status!="success"){if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});return;}rst=$.parseJSON(rst);if(rst.rst=="ERROR_INVALIDREQUESTTOKEN"){if(tmpapiobj.isFristRequestError==true){tmpapiobj.isFristRequestError=false;tmpapiobj.getrequesttoken(tmpapiobj.getit);}else{if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});}}else if(rst.rst=="ERROR_INVALIDUSERTOKEN"){if(tmpapiobj.isFristUserError==true){tmpapiobj.isFristUserError=false;tmpapiobj.getusertoken(tmpapiobj.getit);}else{if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});}}else{if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb(rst);}});}
if(tmpapiobj.isFrist==true){setTimeout(function(){if(tmpapiobj.isCbEnd==true){return;}else{if(baseobj._isatlogin==true){return;}else{if(tipname!=null){baseobj.endTip(tipname);}cb({rst:"ERROR_SERVERERROR"});}}},baseobj._defaulttimeout*1000);tmpapiobj.getit(null);}},login:function(cb,isAutoCall){var baseobj=this;var tmpusertoken=baseobj.storage("NASDK_JS_usertoken");if(tmpusertoken!=null){baseobj.clearStorage();alert("Sorry, fail to login, please re-login.");window.location.reload(true);return;}isAutoCall=(typeof(isAutoCall)=="undefined")?null:isAutoCall;var tmpapiobj={};tmpapiobj.isFristRequestError=true;var nowws=function(){baseobj._isatlogin=false;if(baseobj._recognkey==null||baseobj._logininfo==null){cb({rst:"ERROR_SERVERERROR"});for(var i=0;i<baseobj._logincbary.length;i++){baseobj._logincbary[i]({rst:"ERROR_SERVERERROR"});}baseobj._logincbary.length=0;return;}var infostr=JSON.stringify(baseobj._logininfo);var infostc={requesttoken:baseobj._requesttoken};if(baseobj._logininfo.source=='fb'){infostc.source=baseobj._logininfo.source;infostc.email=baseobj._logininfo.email;infostc.sourceid=baseobj._logininfo.fbid;infostc.info=baseobj._logininfo.info;}else{infostc.source=baseobj._logininfo.source;infostc.email=baseobj._logininfo.email;infostc.password=baseobj._logininfo.password;infostc.info=baseobj._logininfo.info;}tmpapiobj.getrequesttoken=function(tmpcb){$.getJSON("https://api.naturalreaders.com/v2/auth/requesttoken?callback=?",{appid:baseobj._appid,appsecret:baseobj._appsecret},null).always(function(rst,status,xhr){if(status!="success"){tmpcb({rst:"ERROR_SERVERERROR"});return;}if(rst.rst!="true"){tmpcb({rst:"ERROR_SERVERERROR"});}else{baseobj._requesttoken=rst.requesttoken;baseobj.storage("NASDK_JS_requesttoken",baseobj._requesttoken);tmpcb(null);}});}
$.getJSON("https://api.naturalreaders.com/v2/user/login?callback=?",infostc,null).always(function(rst,status,xhr){if(status!="success"){cb({rst:"ERROR_SERVERERROR"});for(var i=0;i<baseobj._logincbary.length;i++){baseobj._logincbary[i]({rst:"ERROR_SERVERERROR"});}baseobj._logincbary.length=0;return;}if(rst.rst=="ERROR_INVALIDREQUESTTOKEN"){if(tmpapiobj.isFristRequestError==true){tmpapiobj.isFristRequestError=false;tmpapiobj.getrequesttoken(nowws);}else{if(tipname!=null){baseobj.endTip(tipname);}tmpapiobj.isCbEnd=true;cb({rst:"ERROR_SERVERERROR"});}}else if(rst.rst=="OK"){baseobj._usertoken=rst.usertoken;baseobj.storage("NASDK_JS_usertoken",rst.usertoken);if(isAutoCall!=null){cb(null);for(var i=0;i<baseobj._logincbary.length;i++){baseobj._logincbary[i](null);}baseobj._logincbary.length=0;}else{cb(rst);for(var i=0;i<baseobj._logincbary.length;i++){baseobj._logincbary[i](rst);}baseobj._logincbary.length=0;}}else{cb(rst);for(var i=0;i<baseobj._logincbary.length;i++){baseobj._logincbary[i](rst);}baseobj._logincbary.length=0;}});}
if(baseobj._recognkey==null||baseobj._logininfo==null){if(baseobj._loginprepare==null){cb({rst:"ERROR_SERVERERROR"});}else{if(baseobj._isatlogin==false){baseobj._isatlogin=true;baseobj._loginprepare(nowws);}else{baseobj._logincbary.push(cb);}}}else{nowws();}},logout:function(){var baseobj=this;baseobj.clearStorage();$.getJSON("https://api.naturalreaders.com/v2/user/logout?callback=?",{requesttoken:baseobj._requesttoken,recognkey:baseobj._recognkey},null).always(function(rst,status,xhr){baseobj._logoutclearance();});},getLoginStatus:function(){if(this._recognkey==null){return false;}else{return true;}},setDefaultTip:function(begindefaulttip,enddefaulttip){this.addTip("NASDK_Default",begindefaulttip,enddefaulttip);},setAuthPrepare:function(loginPrepare,logoutClearance){this._loginprepare=loginPrepare;this._logoutclearance=logoutClearance;},addTip:function(tipname,begintip,endtip){for(var i=0;i<this._tiplist.length;i++){if(this._tiplist[i].tipname==tipname){this._tiplist[i].begintip=begintip;this._tiplist[i].endtip=endtip;return;}}this._tiplist.push({tipname:tipname,begintip:begintip,endtip:endtip});},delTip:function(tipname){var tmpindex=null;for(var i=0;i<this._tiplist.length;i++){if(this._tiplist[i].tipname==tipname){tmpindex=i;}}if(tmpindex!=null){this._tiplist.splice(tmpindex,1);}},beginTip:function(tipname,tipdata){for(var i=0;i<this._tiplist.length;i++){if(this._tiplist[i].tipname==tipname){this._tiplist[i].begintip(tipdata);return;}}},endTip:function(tipname){for(var i=0;i<this._tiplist.length;i++){if(this._tiplist[i].tipname==tipname){this._tiplist[i].endtip();return;}}},tip:function(tipname,tipdata,tipinterval){for(var i=0;i<this._tiplist.length;i++){if(this._tiplist[i].tipname==tipname){this._tiplist[i].begintip(tipdata);setInterval(this._tiplist[i].endtip,tipinterval);return;}}}}}